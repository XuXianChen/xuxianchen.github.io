<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>XXC的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="xuxiancheng,XXC的个人博客">
  
  <meta name="description" content="XXC的个人博客">
<meta name="keywords" content="后端, JAVA, java, Spring, 设计模式, mybatis, mysql, Mysql, oracle, springcloud, springboot">
<meta property="og:type" content="website">
<meta property="og:title" content="XXC的个人博客">
<meta property="og:url" content="http://xuxiancheng.xyz/index.html">
<meta property="og:site_name" content="XXC的个人博客">
<meta property="og:description" content="XXC的个人博客">
<meta property="og:locale" content="chinese">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XXC的个人博客">
<meta name="twitter:description" content="XXC的个人博客">
  
  
    <link rel="icon" href="images/logo1.png">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">XXC的个人博客</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo1.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        XXC的个人博客
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个专注于 服务端 技术的博客网站
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap">
  
    <article id="post-JVM-01-内存管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/25/JVM-01-内存管理/"  >JVM-01-内存管理</a>
    </h1>
  

          
              <span class="header-cate">
                <i class="fa fa-map-marker"></i>
                  
                  <a href="/categories/Java/">Java</a>
                  
              </span>
          
      </header>
    
    <div class="article-entry " itemprop="articleBody">
      
            
            <blockquote>
<p>Java语言的内存管理由JVM自动管理，无需像C++这样由程序员来内存分配和内存回收。理解Java内存管理的原理后，当系统发生OOM等异常时，可以分析和定位问题，并进行合理的调优。</p>
</blockquote>
<a id="more"></a>

<p>JVM中的垃圾回收器不仅会进行垃圾回收，还会影响内存分配策略。例如通过相关GC参数可以配置新生代、老年代的大小和比例，可以配置对象大小超过一定阈值，直接进入老年代。</p>
<p><img src="http://xuxiancheng.xyz/images/jvm_gc.png" alt="对象创建和回收的流程"></p>
<h1 id="1-内存分配"><a href="#1-内存分配" class="headerlink" title="1 内存分配"></a>1 内存分配</h1><h2 id="1-1-Java对象的实现"><a href="#1-1-Java对象的实现" class="headerlink" title="1.1 Java对象的实现"></a>1.1 Java对象的实现</h2><h3 id="1-1-1-对象的创建以及内存分配"><a href="#1-1-1-对象的创建以及内存分配" class="headerlink" title="1.1.1 对象的创建以及内存分配"></a>1.1.1 对象的创建以及内存分配</h3><p>这里的对象指普通的Java对象，不包括Class对象以及数组等特殊情况)的创建过程</p>
<p>1、类加载：程序执行的过程中，遇到new关键字的时候，首先会去检查指令对应的参数（javap反编译class文件可以看到）在类的常量池中是否可以定位到对应的类符号引用，并且检查类是否已被加载（加载、验证、准备、解析、初始化），如果没有，将会触发类加载。</p>
<p>2、内存分配过程: 内存分配的过程，其实就是将堆中内存划分给该对象（可能是不连续的，取决于GC类型），对象的内存在类加载完成就可以确定下来。内存分配过程中有以下几点需要注意: </p>
<ul>
<li>新生的对象在Eden区（新生代）中分配。通过JVM启动参数: -XX:+PrintGCDetails可以看到GC日志详情，查看垃圾回收的情况</li>
<li>大对象直接进入老年代。新生代的垃圾回收算法采用的是标记复制算法，如果JVM中存在大量的大对象时候，需要考虑将大对象直接分配到老年代，因为复制操作对于大对象来说是一个非常高额的内存开销。HotSpot虚拟机提供的-XX:PretenureSizeThreshold=3145728的参数，可以让JVM超过一定大小的对象直接进入老年代（这里配置的是3M）。</li>
<li>长时间存活的对象将进入老年代。Java中默认经过15次的minor GC没有被回收的对象将进入老年代，这里的晋升的年龄阈值可以通过参数：-XX: MaxTenuringThreshold=15来进行配置。</li>
<li>动态的对象年龄判断：为了能更好地适应不同程序的内存状况，HotSpot虚拟机并不是永远要求对象的年龄必须达到-XX：MaxTenuringThreshold才能晋升老年代，如果在Survivor空间中相同年龄所有对象大小的总和大于Survivor空间的一半，年龄大于或等于该年龄的对象就可以直接进入老年代，无须等到-XX：MaxTenuringThreshold中要求的年龄。</li>
<li>通过GC相关的日志，可以看出，到对象Allocation failure （内存分配失败）的时候，会粗发垃圾回收。</li>
</ul>
<h3 id="1-1-2-对象的组成结构"><a href="#1-1-2-对象的组成结构" class="headerlink" title="1.1.2 对象的组成结构"></a>1.1.2 对象的组成结构</h3><p>Java中的对象主要由以下三部分组成: 对象头、实例数据、对其填充字节</p>
<p>对象头又由三部分组成：Mark Word、指向类的指针、数组的长度（数组对象才有）。64位的操作系统普通对象头为12个字节、如果是数组，数组长度占用4个字节，合计16个字节。</p>
<p>Mark Word中包括了对象的分代年龄、锁相关信息，对象HashCode等信息，并且不同操作系统的Mark Work存储内容有所区别，32位JVM中Mark Word如图所示：<br><img src="http://xuxiancheng.xyz/images/jvm_instance_mark_word.png" alt="32位JVMMark Word组成"></p>
<p>实例数据就是属性的相关存储，方法是不会占用对象的存储空间的</p>
<p>64位的JVM要求对象的大小是8的整数倍，对其填充字节就是用来补齐对应缺少的空间，没有实际的意义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">long</span> b;</span><br><span class="line">    <span class="keyword">double</span> c;</span><br><span class="line">    <span class="keyword">byte</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 64位JVM情况下，该类的实例大小为：12字节（对象头） + 4字节（int） + 8字节（double） + 8字节（long）+ 1字节（byte）+ 7字节（对象补齐，8的倍数） = 5 * 8 = 40字节</span></span><br></pre></td></tr></table></figure>

<h3 id="1-1-3-对象的访问-指针、句柄"><a href="#1-1-3-对象的访问-指针、句柄" class="headerlink" title="1.1.3 对象的访问: 指针、句柄"></a>1.1.3 对象的访问: 指针、句柄</h3><p>参考《深入理解JVM》中2.3.3相关内容</p>
<p>指针：存储对象实际的地址，速度较快</p>
<p>句柄：存储句柄池中对应句柄的地址，句柄存储实际对象的指针的地址，对象移动后，引用地址不会发生变化</p>
<h1 id="2-内存回收"><a href="#2-内存回收" class="headerlink" title="2 内存回收"></a>2 内存回收</h1><h2 id="2-1-对象回收条件是什么？"><a href="#2-1-对象回收条件是什么？" class="headerlink" title="2.1 对象回收条件是什么？"></a>2.1 对象回收条件是什么？</h2><ul>
<li>引用计数法：每个对象有一个引用计数器，每被引用一次计数器+1。致命的缺陷：无法解决循环依赖问题。</li>
<li>对象追踪法：通过GC ROOT（类的静态字段，正在执行的方法的局部变量）向下搜索，如果对象没有在对应的搜索链中，则标记对象是可以被回收的。</li>
</ul>
<h2 id="2-2-GC核心内容"><a href="#2-2-GC核心内容" class="headerlink" title="2.2 GC核心内容"></a>2.2 GC核心内容</h2><h3 id="2-2-1-分代算法的背景"><a href="#2-2-1-分代算法的背景" class="headerlink" title="2.2.1 分代算法的背景"></a>2.2.1 分代算法的背景</h3><p>绝大部分新建的对象存活的时间都很短，而存活时间较长的对象，往往很难被回收。所以提出一种将存活时间较短和较长的对象分开管理，采用不同的回收算法进行处理。</p>
<h3 id="2-2-2-GC算法分类"><a href="#2-2-2-GC算法分类" class="headerlink" title="2.2.2 GC算法分类"></a>2.2.2 GC算法分类</h3><ul>
<li>标记-复制算法：首先通过引用追踪法标记那些对象会被回收，将存活的对象复制到另外一块完全空闲的区间，空间换时间的做法，适合于新创建对象回收。</li>
<li>标记-清除算法: 首先通过引用追踪法标记那些对象会被回收，然后将需要回收的对象清除，会形成空间碎片，使用应用管理法可以解决大对象无法分配问题，典型的如CMS回收器。</li>
<li>标记-清除-整理算法：在标记-清除算法的基础上，增加了整理过程，解决内存碎片问题，但是性能较差。</li>
</ul>
<h3 id="2-3-JVM中的GC实现"><a href="#2-3-JVM中的GC实现" class="headerlink" title="2.3 JVM中的GC实现"></a>2.3 JVM中的GC实现</h3><h4 id="2-3-1-串行GC-Serial收集器"><a href="#2-3-1-串行GC-Serial收集器" class="headerlink" title="2.3.1 串行GC: Serial收集器"></a>2.3.1 串行GC: Serial收集器</h4><p>Serial收集器是单线程（即便是多核心CPU，也只会启动一个线程处理垃圾回收，性能较差）的收集器，进行垃圾回收时，会暂停所有的业务线程（Stop The World），Serial收集器分有新生代和老年代两个版本，年轻代使用标记-复制算法，老年代使用标记-清除-整理算法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用该类来查看GC回收情况</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GCLogAnalysis</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> startMillis = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 持续运行毫秒数</span></span><br><span class="line">        <span class="keyword">long</span> timeoutMillis = TimeUnit.SECONDS.toMillis(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">long</span> endMillis = startMillis + timeoutMillis;</span><br><span class="line">        LongAdder counter = <span class="keyword">new</span> LongAdder();</span><br><span class="line">        System.out.println(<span class="string">"正在执行..."</span>);</span><br><span class="line">        <span class="comment">// 缓存一部分对象；进入老年代</span></span><br><span class="line">        <span class="keyword">int</span> cacheSize = <span class="number">2000</span>;</span><br><span class="line">        Object[] cachedGarbage = <span class="keyword">new</span> Object[cacheSize];</span><br><span class="line">        <span class="comment">// 在此时间范围内，持续循环</span></span><br><span class="line">        <span class="keyword">while</span> (System.currentTimeMillis() &lt; endMillis) &#123;</span><br><span class="line">            <span class="comment">// 生成垃圾对象</span></span><br><span class="line">            Object garbage = generateGarbage(<span class="number">100</span>*<span class="number">1024</span>);</span><br><span class="line">            counter.increment();</span><br><span class="line">            <span class="keyword">int</span> randomIndex = random.nextInt(<span class="number">2</span> * cacheSize);</span><br><span class="line">            <span class="keyword">if</span> (randomIndex &lt; cacheSize) &#123;</span><br><span class="line">                cachedGarbage[randomIndex] = garbage;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"ִ执行结束！共生成对象次数："</span> + counter.longValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成对象</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title">generateGarbage</span><span class="params">(<span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> randomSize = random.nextInt(max);</span><br><span class="line">        <span class="keyword">int</span> type = randomSize % <span class="number">4</span>;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                result = <span class="keyword">new</span> <span class="keyword">int</span>[randomSize];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                result = <span class="keyword">new</span> <span class="keyword">byte</span>[randomSize];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                result = <span class="keyword">new</span> <span class="keyword">double</span>[randomSize];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                String randomString = <span class="string">"randomString-Anything"</span>;</span><br><span class="line">                <span class="keyword">while</span> (builder.length() &lt; randomSize) &#123;</span><br><span class="line">                    builder.append(randomString);</span><br><span class="line">                    builder.append(max);</span><br><span class="line">                    builder.append(randomSize);</span><br><span class="line">                &#125;</span><br><span class="line">                result = builder.toString();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">GC日志输出如下</span><br><span class="line"></span><br><span class="line">配置堆1g内存时候，平均创建11000个对象，GC日志输出：</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (25.241-b07) for bsd-amd64 JRE (1.8.0_241-b07), built on Dec 11 2019 02:29:59 by &quot;java_re&quot; with gcc 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)</span><br><span class="line">Memory: 4k page, physical 16777216k(1140192k free)</span><br><span class="line"></span><br><span class="line">/proc/meminfo:</span><br><span class="line"></span><br><span class="line">CommandLine flags: -XX:InitialHeapSize=1073741824 -XX:MaxHeapSize=1073741824 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseSerialGC </span><br><span class="line">0.243: [GC (Allocation Failure) 0.243: [DefNew: 279616K-&gt;34943K(314560K), 0.0499007 secs] 279616K-&gt;90244K(1013632K), 0.0500442 secs] [Times: user=0.03 sys=0.02, real=0.05 secs] </span><br><span class="line">0.337: [GC (Allocation Failure) 0.337: [DefNew: 314478K-&gt;34943K(314560K), 0.0643835 secs] 369778K-&gt;177636K(1013632K), 0.0644476 secs] [Times: user=0.04 sys=0.03, real=0.07 secs] </span><br><span class="line">0.435: [GC (Allocation Failure) 0.435: [DefNew: 314559K-&gt;34943K(314560K), 0.0485544 secs] 457252K-&gt;256922K(1013632K), 0.0486177 secs] [Times: user=0.03 sys=0.02, real=0.05 secs] </span><br><span class="line">0.516: [GC (Allocation Failure) 0.517: [DefNew: 314559K-&gt;34943K(314560K), 0.0503952 secs] 536538K-&gt;342517K(1013632K), 0.0504698 secs] [Times: user=0.03 sys=0.02, real=0.05 secs] </span><br><span class="line">0.600: [GC (Allocation Failure) 0.600: [DefNew: 314559K-&gt;34943K(314560K), 0.0450262 secs] 622133K-&gt;419580K(1013632K), 0.0451010 secs] [Times: user=0.03 sys=0.02, real=0.05 secs] </span><br><span class="line">0.678: [GC (Allocation Failure) 0.678: [DefNew: 314559K-&gt;34944K(314560K), 0.0440851 secs] 699196K-&gt;493985K(1013632K), 0.0441582 secs] [Times: user=0.03 sys=0.02, real=0.05 secs] </span><br><span class="line">0.757: [GC (Allocation Failure) 0.757: [DefNew: 314560K-&gt;34943K(314560K), 0.0471530 secs] 773601K-&gt;573158K(1013632K), 0.0472462 secs] [Times: user=0.03 sys=0.02, real=0.05 secs] </span><br><span class="line">0.839: [GC (Allocation Failure) 0.839: [DefNew: 314559K-&gt;34941K(314560K), 0.0538467 secs] 852774K-&gt;662177K(1013632K), 0.0539075 secs] [Times: user=0.03 sys=0.02, real=0.06 secs] </span><br><span class="line">0.926: [GC (Allocation Failure) 0.926: [DefNew: 314557K-&gt;314557K(314560K), 0.0000134 secs]0.926: [Tenured: 627235K-&gt;375476K(699072K), 0.0639137 secs] 941793K-&gt;375476K(1013632K), [Metaspace: 3151K-&gt;3151K(1056768K)], 0.0640007 secs] [Times: user=0.06 sys=0.00, real=0.07 secs] </span><br><span class="line">1.024: [GC (Allocation Failure) 1.024: [DefNew: 279616K-&gt;34943K(314560K), 0.0130870 secs] 655092K-&gt;460183K(1013632K), 0.0131513 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] </span><br><span class="line">1.069: [GC (Allocation Failure) 1.069: [DefNew: 314559K-&gt;34943K(314560K), 0.0175508 secs] 739799K-&gt;538555K(1013632K), 0.0176269 secs] [Times: user=0.01 sys=0.00, real=0.02 secs] </span><br><span class="line">Heap</span><br><span class="line"> def new generation   total 314560K, used 65537K [0x0000000780000000, 0x0000000795550000, 0x0000000795550000)</span><br><span class="line">  eden space 279616K,  10% used [0x0000000780000000, 0x0000000781de05c8, 0x0000000791110000)</span><br><span class="line">  from space 34944K,  99% used [0x0000000791110000, 0x000000079332fff0, 0x0000000793330000)</span><br><span class="line">  to   space 34944K,   0% used [0x0000000793330000, 0x0000000793330000, 0x0000000795550000)</span><br><span class="line"> tenured generation   total 699072K, used 503611K [0x0000000795550000, 0x00000007c0000000, 0x00000007c0000000)</span><br><span class="line">   the space 699072K,  72% used [0x0000000795550000, 0x00000007b411ec30, 0x00000007b411ee00, 0x00000007c0000000)</span><br><span class="line"> Metaspace       used 3158K, capacity 4500K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 348K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置堆256M时候，控制台线上创建了4000多个对象，并且多次尝试，有时候会出现OOM异常，GC日志输出：</span><br><span class="line"></span><br><span class="line">CommandLine flags: -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=268435456 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseSerialGC </span><br><span class="line">0.225: [GC (Allocation Failure) 0.225: [DefNew: 69680K-&gt;8704K(78656K), 0.0138137 secs] 69680K-&gt;22490K(253440K), 0.0139491 secs] [Times: user=0.01 sys=0.01, real=0.01 secs] </span><br><span class="line">0.252: [GC (Allocation Failure) 0.252: [DefNew: 78616K-&gt;8701K(78656K), 0.0189977 secs] 92402K-&gt;48947K(253440K), 0.0190551 secs] [Times: user=0.01 sys=0.01, real=0.01 secs] </span><br><span class="line">0.282: [GC (Allocation Failure) 0.282: [DefNew: 78653K-&gt;8700K(78656K), 0.0159092 secs] 118899K-&gt;72091K(253440K), 0.0159708 secs] [Times: user=0.01 sys=0.01, real=0.01 secs] </span><br><span class="line">0.307: [GC (Allocation Failure) 0.307: [DefNew: 78584K-&gt;8702K(78656K), 0.0147239 secs] 141975K-&gt;95231K(253440K), 0.0148001 secs] [Times: user=0.01 sys=0.00, real=0.02 secs] </span><br><span class="line">0.331: [GC (Allocation Failure) 0.331: [DefNew: 78654K-&gt;8703K(78656K), 0.0116760 secs] 165183K-&gt;115178K(253440K), 0.0117479 secs] [Times: user=0.00 sys=0.01, real=0.02 secs] </span><br><span class="line">0.351: [GC (Allocation Failure) 0.351: [DefNew: 78589K-&gt;8701K(78656K), 0.0142015 secs] 185063K-&gt;138429K(253440K), 0.0142508 secs] [Times: user=0.01 sys=0.00, real=0.02 secs] </span><br><span class="line">0.374: [GC (Allocation Failure) 0.374: [DefNew: 78653K-&gt;8699K(78656K), 0.0136984 secs] 208381K-&gt;162108K(253440K), 0.0137549 secs] [Times: user=0.00 sys=0.01, real=0.01 secs] </span><br><span class="line">0.398: [GC (Allocation Failure) 0.398: [DefNew: 78651K-&gt;78651K(78656K), 0.0000121 secs]0.398: [Tenured: 153409K-&gt;158357K(174784K), 0.0216209 secs] 232060K-&gt;158357K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0216994 secs] [Times: user=0.02 sys=0.00, real=0.02 secs] </span><br><span class="line">0.428: [GC (Allocation Failure) 0.428: [DefNew: 69698K-&gt;69698K(78656K), 0.0000122 secs]0.428: [Tenured: 158357K-&gt;174653K(174784K), 0.0278269 secs] 228056K-&gt;174793K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0278997 secs] [Times: user=0.03 sys=0.01, real=0.03 secs] </span><br><span class="line">0.466: [Full GC (Allocation Failure) 0.466: [Tenured: 174653K-&gt;174555K(174784K), 0.0244555 secs] 253303K-&gt;192263K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0245220 secs] [Times: user=0.02 sys=0.00, real=0.02 secs] </span><br><span class="line">0.499: [Full GC (Allocation Failure) 0.499: [Tenured: 174699K-&gt;174666K(174784K), 0.0272722 secs] 253326K-&gt;194733K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0273429 secs] [Times: user=0.02 sys=0.00, real=0.03 secs] </span><br><span class="line">0.534: [Full GC (Allocation Failure) 0.535: [Tenured: 174666K-&gt;174666K(174784K), 0.0050084 secs] 253298K-&gt;211076K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0050718 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] </span><br><span class="line">0.545: [Full GC (Allocation Failure) 0.545: [Tenured: 174666K-&gt;174690K(174784K), 0.0121498 secs] 253073K-&gt;219967K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0122110 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">0.562: [Full GC (Allocation Failure) 0.562: [Tenured: 174690K-&gt;174769K(174784K), 0.0151894 secs] 253076K-&gt;228094K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0152554 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] </span><br><span class="line">0.580: [Full GC (Allocation Failure) 0.580: [Tenured: 174769K-&gt;174346K(174784K), 0.0305992 secs] 252972K-&gt;219803K(253440K), [Metaspace: 3012K-&gt;3012K(1056768K)], 0.0306786 secs] [Times: user=0.03 sys=0.00, real=0.03 secs] </span><br><span class="line">...(省略大量full gc日志)</span><br><span class="line"></span><br><span class="line">从GC日志其实看不出什么，需要和其他GC收集器进行比较，从日志中可以看出，老年代的回收效率很低（程序中有一个缓存数组，数据一直存在），并且很快就会发生FUll GC，并且每次回收的数据很低，所以一直触发FULL GC。</span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="2-3-2-并行GC"><a href="#2-3-2-并行GC" class="headerlink" title="2.3.2 并行GC"></a>2.3.2 并行GC</h4></li>
</ul>
<p>ParNew收集器是（新生代收集器）Serial的多线程版本，实现算法、对象分配规则等和serial收集器一样。</p>
<p>Parallel Scavenge收集器（新生代收集器），算法同样采用标记-清除算法，也是多线程并行收集。相比于ParNew，Parallel Scavenge的目标是达到一个可控制的吞吐量，核心关注的是吞吐量。Parallel Scavenge有两个参数可以设置：垃圾收集最大停顿时间（-XX:MaxGCPauseMillis）,吞吐量大小（GCTimeRatio）。Parallel Scavenge的停顿时间是牺牲吞吐量和新生代空间为代价的，新生代会动态的跳转新生代的大小，每次收集会变得更短，但是GC会发生的更加频繁。Parallel Scavenge的自适应策略可以通过参数+U+UseAdaptiveSizePolicy调整</p>
<p>老年代为Parallel Old收集器，多线程并发收集，吞吐量优先，是Parallel GC的老年版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">配置堆1g时候，平均创建了13000多个对象，GC日志输出（Java 8默认使用的收集器就是并行GC，其实可以不用显示的指定）：</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (25.241-b07) for bsd-amd64 JRE (1.8.0_241-b07), built on Dec 11 2019 02:29:59 by &quot;java_re&quot; with gcc 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)</span><br><span class="line">Memory: 4k page, physical 16777216k(1222804k free)</span><br><span class="line"></span><br><span class="line">/proc/meminfo:</span><br><span class="line"></span><br><span class="line">CommandLine flags: -XX:InitialHeapSize=1073741824 -XX:MaxHeapSize=1073741824 -XX:ParallelGCThreads=3 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC </span><br><span class="line">0.254: [GC (Allocation Failure) [PSYoungGen: 262144K-&gt;43519K(305664K)] 262144K-&gt;76060K(1005056K), 0.0278397 secs] [Times: user=0.03 sys=0.04, real=0.02 secs] </span><br><span class="line">0.323: [GC (Allocation Failure) [PSYoungGen: 305663K-&gt;43509K(305664K)] 338204K-&gt;146665K(1005056K), 0.0388654 secs] [Times: user=0.04 sys=0.06, real=0.04 secs] </span><br><span class="line">0.402: [GC (Allocation Failure) [PSYoungGen: 305653K-&gt;43506K(305664K)] 408809K-&gt;219028K(1005056K), 0.0312535 secs] [Times: user=0.04 sys=0.05, real=0.03 secs] </span><br><span class="line">0.468: [GC (Allocation Failure) [PSYoungGen: 305650K-&gt;43512K(305664K)] 481172K-&gt;290878K(1005056K), 0.0291743 secs] [Times: user=0.04 sys=0.04, real=0.03 secs] </span><br><span class="line">0.528: [GC (Allocation Failure) [PSYoungGen: 305542K-&gt;43507K(305664K)] 552908K-&gt;364548K(1005056K), 0.0270624 secs] [Times: user=0.04 sys=0.04, real=0.03 secs] </span><br><span class="line">0.586: [GC (Allocation Failure) [PSYoungGen: 305651K-&gt;43518K(160256K)] 626692K-&gt;444397K(859648K), 0.0289559 secs] [Times: user=0.04 sys=0.04, real=0.03 secs] </span><br><span class="line">0.628: [GC (Allocation Failure) [PSYoungGen: 160254K-&gt;73059K(232960K)] 561133K-&gt;480357K(932352K), 0.0095070 secs] [Times: user=0.03 sys=0.01, real=0.01 secs] </span><br><span class="line">0.652: [GC (Allocation Failure) [PSYoungGen: 189795K-&gt;96246K(232960K)] 597093K-&gt;512153K(932352K), 0.0127211 secs] [Times: user=0.03 sys=0.00, real=0.02 secs] </span><br><span class="line">0.683: [GC (Allocation Failure) [PSYoungGen: 212982K-&gt;106127K(232960K)] 628889K-&gt;539086K(932352K), 0.0162174 secs] [Times: user=0.04 sys=0.01, real=0.02 secs] </span><br><span class="line">0.715: [GC (Allocation Failure) [PSYoungGen: 222863K-&gt;75379K(232960K)] 655822K-&gt;568277K(932352K), 0.0241031 secs] [Times: user=0.03 sys=0.03, real=0.02 secs] </span><br><span class="line">0.754: [GC (Allocation Failure) [PSYoungGen: 192115K-&gt;38897K(232960K)] 685013K-&gt;599684K(932352K), 0.0233994 secs] [Times: user=0.03 sys=0.04, real=0.02 secs] </span><br><span class="line">0.792: [GC (Allocation Failure) [PSYoungGen: 155123K-&gt;37858K(232960K)] 715909K-&gt;634441K(932352K), 0.0147090 secs] [Times: user=0.03 sys=0.02, real=0.02 secs] </span><br><span class="line">0.807: [Full GC (Ergonomics) [PSYoungGen: 37858K-&gt;0K(232960K)] [ParOldGen: 596583K-&gt;342363K(699392K)] 634441K-&gt;342363K(932352K), [Metaspace: 3151K-&gt;3151K(1056768K)], 0.0433573 secs] [Times: user=0.10 sys=0.00, real=0.04 secs] </span><br><span class="line">0.869: [GC (Allocation Failure) [PSYoungGen: 116736K-&gt;40373K(232960K)] 459099K-&gt;382736K(932352K), 0.0056151 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">0.891: [GC (Allocation Failure) [PSYoungGen: 156990K-&gt;36664K(232960K)] 499353K-&gt;415013K(932352K), 0.0096808 secs] [Times: user=0.03 sys=0.00, real=0.01 secs] </span><br><span class="line">0.917: [GC (Allocation Failure) [PSYoungGen: 153400K-&gt;44460K(232960K)] 531749K-&gt;453981K(932352K), 0.0076890 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">0.942: [GC (Allocation Failure) [PSYoungGen: 161196K-&gt;37975K(232960K)] 570717K-&gt;488274K(932352K), 0.0089674 secs] [Times: user=0.03 sys=0.00, real=0.01 secs] </span><br><span class="line">0.967: [GC (Allocation Failure) [PSYoungGen: 154711K-&gt;36330K(232960K)] 605010K-&gt;518714K(932352K), 0.0073869 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">0.991: [GC (Allocation Failure) [PSYoungGen: 153066K-&gt;38965K(232960K)] 635450K-&gt;553041K(932352K), 0.0076607 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">1.015: [GC (Allocation Failure) [PSYoungGen: 155701K-&gt;38422K(232960K)] 669777K-&gt;588295K(932352K), 0.0088705 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">1.039: [GC (Allocation Failure) [PSYoungGen: 155117K-&gt;35368K(232960K)] 704989K-&gt;619119K(932352K), 0.0080958 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">1.063: [GC (Allocation Failure) [PSYoungGen: 151786K-&gt;38380K(232960K)] 735537K-&gt;652912K(932352K), 0.0139422 secs] [Times: user=0.03 sys=0.01, real=0.01 secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 232960K, used 144404K [0x00000007aab00000, 0x00000007c0000000, 0x00000007c0000000)</span><br><span class="line">  eden space 116736K, 90% used [0x00000007aab00000,0x00000007b1289df8,0x00000007b1d00000)</span><br><span class="line">  from space 116224K, 33% used [0x00000007b1d00000,0x00000007b427b308,0x00000007b8e80000)</span><br><span class="line">  to   space 116224K, 0% used [0x00000007b8e80000,0x00000007b8e80000,0x00000007c0000000)</span><br><span class="line"> ParOldGen       total 699392K, used 614531K [0x0000000780000000, 0x00000007aab00000, 0x00000007aab00000)</span><br><span class="line">  object space 699392K, 87% used [0x0000000780000000,0x00000007a5820d68,0x00000007aab00000)</span><br><span class="line"> Metaspace       used 3158K, capacity 4500K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 348K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br><span class="line">相比串联GC，可以看出，并行GC的时间更短，并且吞吐量更高一些，并且可以看到并行GC的新生代的大小会动态的进行调整，并且Young GC（会很频繁自适应策略）。</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-并发收集器CMS"><a href="#2-3-3-并发收集器CMS" class="headerlink" title="2.3.3 并发收集器CMS"></a>2.3.3 并发收集器CMS</h4><p>CMS收集器的目标是尽量减少停顿时间为目标，回收算法采用标记-清除算法。其实现的原理为：将垃圾收集分成多个步骤，某些步骤和应用系统的线程并发执行，但是任然有某些步骤需要Stop The World，从而尽量减少程序暂停时间。</p>
<p>缺点：</p>
<ul>
<li>对处理器资源敏感。CMS默认启动的回收线程为：（cpu核心数量 + 3）/ 4</li>
<li>无法处理浮动垃圾。JDK5情况下，CMS老年代空间被使用68%就会激活垃圾回收，JDK6，默认调到92%，比例太高出现无法分配会触发预备方案，使用serial old进行回收。</li>
<li>形成空间碎片。但是可以通过设置参数，Full GC可以触发空间整理操作</li>
</ul>
<p>CMS收集器执行分为4个步骤:</p>
<ul>
<li>初始标记（需要暂停）</li>
<li>并发标记（不需要暂停）</li>
<li>重新标记（需要暂停）</li>
<li>并发清除（不需要暂停）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">配置堆1g时候，平均创建了12000多个对象，GC日志输出：</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (25.241-b07) for bsd-amd64 JRE (1.8.0_241-b07), built on Dec 11 2019 02:29:59 by &quot;java_re&quot; with gcc 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)</span><br><span class="line">Memory: 4k page, physical 16777216k(1186432k free)</span><br><span class="line"></span><br><span class="line">/proc/meminfo:</span><br><span class="line"></span><br><span class="line">CommandLine flags: -XX:InitialHeapSize=1073741824 -XX:MaxHeapSize=1073741824 -XX:MaxNewSize=424673280 -XX:MaxTenuringThreshold=6 -XX:NewSize=424673280 -XX:OldPLABSize=16 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:+UseParNewGC </span><br><span class="line">0.297: [GC (Allocation Failure) 0.297: [ParNew: 331776K-&gt;41472K(373248K), 0.0383167 secs] 331776K-&gt;98187K(1007104K), 0.0384181 secs] [Times: user=0.06 sys=0.11, real=0.04 secs] </span><br><span class="line">0.388: [GC (Allocation Failure) 0.388: [ParNew: 373248K-&gt;41470K(373248K), 0.0414143 secs] 429963K-&gt;185939K(1007104K), 0.0414742 secs] [Times: user=0.07 sys=0.13, real=0.04 secs] </span><br><span class="line">0.473: [GC (Allocation Failure) 0.473: [ParNew: 373246K-&gt;41471K(373248K), 0.0615410 secs] 517715K-&gt;277638K(1007104K), 0.0616140 secs] [Times: user=0.29 sys=0.03, real=0.06 secs] </span><br><span class="line">0.580: [GC (Allocation Failure) 0.580: [ParNew: 373247K-&gt;41470K(373248K), 0.0543917 secs] 609414K-&gt;357120K(1007104K), 0.0544575 secs] [Times: user=0.27 sys=0.03, real=0.06 secs] </span><br><span class="line">0.676: [GC (Allocation Failure) 0.676: [ParNew: 373246K-&gt;41471K(373248K), 0.0565282 secs] 688896K-&gt;448077K(1007104K), 0.0566027 secs] [Times: user=0.35 sys=0.03, real=0.06 secs] </span><br><span class="line">0.733: [GC (CMS Initial Mark) [1 CMS-initial-mark: 406605K(633856K)] 454866K(1007104K), 0.0002319 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">0.734: [CMS-concurrent-mark-start]</span><br><span class="line">0.737: [CMS-concurrent-mark: 0.003/0.003 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">0.737: [CMS-concurrent-preclean-start]</span><br><span class="line">0.738: [CMS-concurrent-preclean: 0.001/0.001 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] </span><br><span class="line">0.738: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">0.779: [GC (Allocation Failure) 0.779: [ParNew: 373247K-&gt;41472K(373248K), 0.0572370 secs] 779853K-&gt;536927K(1007104K), 0.0573078 secs] [Times: user=0.33 sys=0.03, real=0.06 secs] </span><br><span class="line">0.879: [GC (Allocation Failure) 0.879: [ParNew: 373248K-&gt;41470K(373248K), 0.0558124 secs] 868703K-&gt;622580K(1007104K), 0.0558771 secs] [Times: user=0.23 sys=0.04, real=0.06 secs] </span><br><span class="line">0.937: [CMS-concurrent-abortable-preclean: 0.005/0.199 secs] [Times: user=0.65 sys=0.07, real=0.20 secs] </span><br><span class="line">0.937: [GC (CMS Final Remark) [YG occupancy: 55224 K (373248 K)]0.937: [Rescan (parallel) , 0.0009121 secs]0.938: [weak refs processing, 0.0000530 secs]0.938: [class unloading, 0.0002892 secs]0.938: [scrub symbol table, 0.0003247 secs]0.939: [scrub string table, 0.0001868 secs][1 CMS-remark: 581110K(633856K)] 636335K(1007104K), 0.0018849 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">0.939: [CMS-concurrent-sweep-start]</span><br><span class="line">0.941: [CMS-concurrent-sweep: 0.002/0.002 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">0.941: [CMS-concurrent-reset-start]</span><br><span class="line">0.942: [CMS-concurrent-reset: 0.001/0.001 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] </span><br><span class="line">0.977: [GC (Allocation Failure) 0.977: [ParNew: 373246K-&gt;41471K(373248K), 0.0214054 secs] 791087K-&gt;547351K(1007104K), 0.0214759 secs] [Times: user=0.12 sys=0.00, real=0.02 secs] </span><br><span class="line">0.999: [GC (CMS Initial Mark) [1 CMS-initial-mark: 505879K(633856K)] 553973K(1007104K), 0.0002420 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">0.999: [CMS-concurrent-mark-start]</span><br><span class="line">1.001: [CMS-concurrent-mark: 0.002/0.002 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">1.001: [CMS-concurrent-preclean-start]</span><br><span class="line">1.002: [CMS-concurrent-preclean: 0.001/0.001 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">1.002: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">1.043: [GC (Allocation Failure) 1.044: [ParNew: 373247K-&gt;41471K(373248K), 0.0352021 secs] 879127K-&gt;647817K(1007104K), 0.0352931 secs] [Times: user=0.16 sys=0.01, real=0.03 secs] </span><br><span class="line">1.079: [CMS-concurrent-abortable-preclean: 0.001/0.077 secs] [Times: user=0.21 sys=0.01, real=0.07 secs] </span><br><span class="line">1.079: [GC (CMS Final Remark) [YG occupancy: 41720 K (373248 K)]1.079: [Rescan (parallel) , 0.0019954 secs]1.081: [weak refs processing, 0.0000435 secs]1.081: [class unloading, 0.0002223 secs]1.081: [scrub symbol table, 0.0002847 secs]1.082: [scrub string table, 0.0001794 secs][1 CMS-remark: 606345K(633856K)] 648065K(1007104K), 0.0028004 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">1.082: [CMS-concurrent-sweep-start]</span><br><span class="line">1.084: [CMS-concurrent-sweep: 0.002/0.002 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] </span><br><span class="line">1.084: [CMS-concurrent-reset-start]</span><br><span class="line">1.084: [CMS-concurrent-reset: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">Heap</span><br><span class="line"> par new generation   total 373248K, used 202620K [0x0000000780000000, 0x0000000799500000, 0x0000000799500000)</span><br><span class="line">  eden space 331776K,  48% used [0x0000000780000000, 0x0000000789d5f120, 0x0000000794400000)</span><br><span class="line">  from space 41472K,  99% used [0x0000000796c80000, 0x00000007994fffb8, 0x0000000799500000)</span><br><span class="line">  to   space 41472K,   0% used [0x0000000794400000, 0x0000000794400000, 0x0000000796c80000)</span><br><span class="line"> concurrent mark-sweep generation total 633856K, used 394739K [0x0000000799500000, 0x00000007c0000000, 0x00000007c0000000)</span><br><span class="line"> Metaspace       used 3157K, capacity 4500K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 348K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br><span class="line">可以看出，回收老年代的过程中，有些步骤没有暂停，还会穿插新生代的回收，可以说明这部分回收是并发执行的</span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-全功能的垃圾回收器G1"><a href="#2-3-4-全功能的垃圾回收器G1" class="headerlink" title="2.3.4 ### 全功能的垃圾回收器G1"></a>2.3.4 ### 全功能的垃圾回收器G1</h4><ul>
<li>追求低延迟的情况下，实现最大的吞吐量</li>
<li>整体来看使用标记-整理算法，从Region来看使用标记-复制算法。</li>
<li>G1是JDK9以后默认的垃圾回收器</li>
<li>G1的核心思想：那一个内存块中的垃圾数量最多，回收收益最大，就回收那一块，更加智能。</li>
<li>G1会将堆内存进行分区（Region），Region是单次回收最小单元，每一个Region都会更具需要扮演Eden、from、to、old等区域，并且会有专门的区域存储大对象，G1认为超过Region的一般大小就认为是大对象。</li>
<li>G1可以配置-XX:MaxGCPauseMillis=50的方式来指定JVM最大停顿时间</li>
<li>通常小内存情况下，使用CMS会更好，大内存情况下使用G1性能会更好。</li>
</ul>
<p>G1的回收大概分为以下几步：</p>
<ul>
<li>初始标记（需要暂停）</li>
<li>并发标记</li>
<li>最终标记（需要暂停）</li>
<li>筛选回收（需要暂停）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">配置堆1g时候，平均创建了12000多个对象，GC日志输出：</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (25.241-b07) for bsd-amd64 JRE (1.8.0_241-b07), built on Dec 11 2019 02:29:59 by &quot;java_re&quot; with gcc 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)</span><br><span class="line">Memory: 4k page, physical 16777216k(982996k free)</span><br><span class="line"></span><br><span class="line">/proc/meminfo:</span><br><span class="line"></span><br><span class="line">CommandLine flags: -XX:InitialHeapSize=1073741824 -XX:MaxHeapSize=1073741824 -XX:+PrintGC -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC </span><br><span class="line">0.170: [GC pause (G1 Evacuation Pause) (young) 67M-&gt;24M(1024M), 0.0074014 secs]</span><br><span class="line">0.195: [GC pause (G1 Evacuation Pause) (young) 88M-&gt;43M(1024M), 0.0060802 secs]</span><br><span class="line">0.212: [GC pause (G1 Evacuation Pause) (young) 101M-&gt;62M(1024M), 0.0066534 secs]</span><br><span class="line">0.244: [GC pause (G1 Evacuation Pause) (young) 150M-&gt;90M(1024M), 0.0092468 secs]</span><br><span class="line">0.291: [GC pause (G1 Evacuation Pause) (young) 210M-&gt;131M(1024M), 0.0131415 secs]</span><br><span class="line">0.643: [GC pause (G1 Evacuation Pause) (young)-- 895M-&gt;636M(1024M), 0.0100717 secs]</span><br><span class="line">0.653: [GC pause (G1 Humongous Allocation) (young) (initial-mark) 637M-&gt;636M(1024M), 0.0012414 secs]</span><br><span class="line">0.654: [GC concurrent-root-region-scan-start]</span><br><span class="line">0.655: [GC concurrent-root-region-scan-end, 0.0001895 secs]</span><br><span class="line">0.655: [GC concurrent-mark-start]</span><br><span class="line">0.659: [GC concurrent-mark-end, 0.0045729 secs]</span><br><span class="line">0.659: [GC remark, 0.0019999 secs]</span><br><span class="line">0.662: [GC cleanup 667M-&gt;665M(1024M), 0.0006712 secs]</span><br><span class="line">0.662: [GC concurrent-cleanup-start]</span><br><span class="line">0.662: [GC concurrent-cleanup-end, 0.0000072 secs]</span><br><span class="line">0.707: [GC pause (G1 Evacuation Pause) (young)-- 884M-&gt;718M(1024M), 0.0095276 secs]</span><br><span class="line">0.720: [GC pause (G1 Evacuation Pause) (mixed) 750M-&gt;627M(1024M), 0.0049723 secs]</span><br><span class="line">0.731: [GC pause (G1 Evacuation Pause) (mixed) 679M-&gt;548M(1024M), 0.0031728 secs]</span><br><span class="line">0.742: [GC pause (G1 Evacuation Pause) (mixed) 605M-&gt;477M(1024M), 0.0054918 secs]</span><br><span class="line">0.754: [GC pause (G1 Evacuation Pause) (mixed) 532M-&gt;415M(1024M), 0.0051192 secs]</span><br><span class="line">0.767: [GC pause (G1 Evacuation Pause) (mixed) 468M-&gt;415M(1024M), 0.0027133 secs]</span><br><span class="line">0.771: [GC pause (G1 Humongous Allocation) (young) (initial-mark) 428M-&gt;419M(1024M), 0.0012447 secs]</span><br><span class="line">0.772: [GC concurrent-root-region-scan-start]</span><br><span class="line">0.772: [GC concurrent-root-region-scan-end, 0.0000871 secs]</span><br><span class="line">0.772: [GC concurrent-mark-start]</span><br><span class="line">0.773: [GC concurrent-mark-end, 0.0010406 secs]</span><br><span class="line">0.773: [GC remark, 0.0011861 secs]</span><br><span class="line">0.775: [GC cleanup 429M-&gt;417M(1024M), 0.0006145 secs]</span><br><span class="line">0.775: [GC concurrent-cleanup-start]</span><br><span class="line">0.775: [GC concurrent-cleanup-end, 0.0000090 secs]</span><br><span class="line">0.845: [GC pause (G1 Evacuation Pause) (young)-- 863M-&gt;666M(1024M), 0.0055881 secs]</span><br><span class="line">0.852: [GC pause (G1 Evacuation Pause) (mixed) 674M-&gt;595M(1024M), 0.0077991 secs]</span><br><span class="line">0.860: [GC pause (G1 Humongous Allocation) (young) (initial-mark) 595M-&gt;595M(1024M), 0.0010706 secs]</span><br><span class="line">0.861: [GC concurrent-root-region-scan-start]</span><br><span class="line">0.861: [GC concurrent-root-region-scan-end, 0.0000843 secs]</span><br><span class="line">0.861: [GC concurrent-mark-start]</span><br><span class="line">0.863: [GC concurrent-mark-end, 0.0013669 secs]</span><br><span class="line">0.863: [GC remark, 0.0011706 secs]</span><br><span class="line">0.864: [GC cleanup 607M-&gt;600M(1024M), 0.0008423 secs]</span><br><span class="line">0.865: [GC concurrent-cleanup-start]</span><br><span class="line">0.865: [GC concurrent-cleanup-end, 0.0000095 secs]</span><br><span class="line">0.904: [GC pause (G1 Evacuation Pause) (young) 867M-&gt;660M(1024M), 0.0081543 secs]</span><br><span class="line">0.916: [GC pause (G1 Evacuation Pause) (mixed) 689M-&gt;572M(1024M), 0.0055816 secs]</span><br><span class="line">0.929: [GC pause (G1 Evacuation Pause) (mixed) 625M-&gt;506M(1024M), 0.0067071 secs]</span><br><span class="line">0.943: [GC pause (G1 Evacuation Pause) (mixed) 563M-&gt;464M(1024M), 0.0070824 secs]</span><br><span class="line">0.950: [GC pause (G1 Humongous Allocation) (young) (initial-mark) 465M-&gt;464M(1024M), 0.0025312 secs]</span><br><span class="line">0.953: [GC concurrent-root-region-scan-start]</span><br><span class="line">0.953: [GC concurrent-root-region-scan-end, 0.0001653 secs]</span><br><span class="line">0.953: [GC concurrent-mark-start]</span><br><span class="line">0.955: [GC concurrent-mark-end, 0.0015150 secs]</span><br><span class="line">0.955: [GC remark, 0.0022781 secs]</span><br><span class="line">0.957: [GC cleanup 474M-&gt;469M(1024M), 0.0008459 secs]</span><br><span class="line">0.958: [GC concurrent-cleanup-start]</span><br><span class="line">0.958: [GC concurrent-cleanup-end, 0.0000224 secs]</span><br><span class="line">1.018: [GC pause (G1 Evacuation Pause) (young)-- 858M-&gt;669M(1024M), 0.0063259 secs]</span><br><span class="line">1.026: [GC pause (G1 Evacuation Pause) (mixed) 681M-&gt;601M(1024M), 0.0084168 secs]</span><br><span class="line">1.035: [GC pause (G1 Humongous Allocation) (young) (initial-mark) 603M-&gt;602M(1024M), 0.0019120 secs]</span><br><span class="line">1.037: [GC concurrent-root-region-scan-start]</span><br><span class="line">1.037: [GC concurrent-root-region-scan-end, 0.0000726 secs]</span><br><span class="line">1.037: [GC concurrent-mark-start]</span><br><span class="line">1.038: [GC concurrent-mark-end, 0.0017016 secs]</span><br><span class="line">1.039: [GC remark, 0.0013882 secs]</span><br><span class="line">1.040: [GC cleanup 613M-&gt;608M(1024M), 0.0010691 secs]</span><br><span class="line">1.041: [GC concurrent-cleanup-start]</span><br><span class="line">1.041: [GC concurrent-cleanup-end, 0.0000102 secs]</span><br><span class="line">1.085: [GC pause (G1 Evacuation Pause) (young)-- 870M-&gt;712M(1024M), 0.0066371 secs]</span><br><span class="line">1.095: [GC pause (G1 Evacuation Pause) (mixed) 743M-&gt;625M(1024M), 0.0060782 secs]</span><br><span class="line">1.111: [GC pause (G1 Evacuation Pause) (mixed) 685M-&gt;566M(1024M), 0.0073196 secs]</span><br><span class="line"></span><br><span class="line">通过日志可以看出：GC pause的时间都会短，基本上都只有几十毫秒，但是GC回收的频率比较高，这可能与程序产生的大对象有关（Region区间一半即为大对象，堆大小为1024M，默认2048个Region，即256K的对象即为大对象，会使用单独的Region存储）</span><br></pre></td></tr></table></figure>

<h3 id="2-4-使用wrk工具对相同的项目-就一个springboot项目-下，不同的GC收集器进行压测"><a href="#2-4-使用wrk工具对相同的项目-就一个springboot项目-下，不同的GC收集器进行压测" class="headerlink" title="2.4 使用wrk工具对相同的项目(就一个springboot项目)下，不同的GC收集器进行压测"></a>2.4 使用wrk工具对相同的项目(就一个springboot项目)下，不同的GC收集器进行压测</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wrk安装：</span><br><span class="line">git clone https://github.com/wg/wrk.git wrk</span><br><span class="line">cd wrk</span><br><span class="line">make</span><br><span class="line">sudo cp wrk /usr/local/bin</span><br></pre></td></tr></table></figure>

<h4 id="2-4-1-serial-收集器测试"><a href="#2-4-1-serial-收集器测试" class="headerlink" title="2.4.1 serial 收集器测试"></a>2.4.1 serial 收集器测试</h4><p>启动本地一个springboot项目进行测试，使用serial 收集器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">JVM启动参数</span><br><span class="line">-XX:+UseSerialGC</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xms512m</span><br><span class="line"></span><br><span class="line">压测结果:</span><br><span class="line">MacBook-Pro:~ xuxiancheng$ wrk -t4 -c50 -d60s http://localhost:8080/v1/research/info?id=11</span><br><span class="line">Running 1m test @ http://localhost:8080/v1/research/info?id=11</span><br><span class="line">  4 threads and 50 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line">    Latency    25.13ms   12.91ms 181.37ms   86.00%</span><br><span class="line">    Req/Sec   256.10    125.53   735.00     79.37%</span><br><span class="line">  16393 requests in 1.08m, 4.35MB read</span><br><span class="line">  Socket errors: connect 0, read 4, write 0, timeout 0</span><br><span class="line">  Non-2xx or 3xx responses: 16393</span><br><span class="line">Requests/sec:    253.77</span><br><span class="line">Transfer/sec:     68.90KB</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-parallel-收集器测试"><a href="#2-4-2-parallel-收集器测试" class="headerlink" title="2.4.2 parallel 收集器测试"></a>2.4.2 parallel 收集器测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">JVM启动参数</span><br><span class="line">-XX:+UseParallelGC</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xms512m</span><br><span class="line"></span><br><span class="line">压测结果:</span><br><span class="line">Running 1m test @ http://localhost:8080/v1/research/info?id=11</span><br><span class="line">  4 threads and 50 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line">    Latency    29.62ms   48.64ms   1.02s    98.81%</span><br><span class="line">    Req/Sec   242.58    119.56   693.00     82.34%</span><br><span class="line">  16377 requests in 1.06m, 4.34MB read</span><br><span class="line">  Socket errors: connect 0, read 5, write 0, timeout 0</span><br><span class="line">  Non-2xx or 3xx responses: 16377</span><br><span class="line">Requests/sec:    257.54</span><br><span class="line">Transfer/sec:     69.92KB</span><br><span class="line"></span><br><span class="line">可以看出并行GC情况下，吞吐量略高于串行GC，与实际的程序运行有关，除非写特定的程序进行模拟</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-CMS-收集器测试"><a href="#2-4-3-CMS-收集器测试" class="headerlink" title="2.4.3 CMS 收集器测试"></a>2.4.3 CMS 收集器测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">JVM启动参数</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xms512m</span><br><span class="line"></span><br><span class="line">压测结果:</span><br><span class="line">MacBook-Pro:~ xuxiancheng$ wrk -t4 -c50 -d60s http://localhost:8080/v1/research/info?id=11</span><br><span class="line">Running 1m test @ http://localhost:8080/v1/research/info?id=11</span><br><span class="line">  4 threads and 50 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line">    Latency    16.94ms   16.99ms 332.85ms   88.53%</span><br><span class="line">    Req/Sec   337.93    295.32     1.83k    86.82%</span><br><span class="line">  16379 requests in 1.00m, 4.34MB read</span><br><span class="line">  Socket errors: connect 0, read 5, write 0, timeout 0</span><br><span class="line">  Non-2xx or 3xx responses: 16379</span><br><span class="line">Requests/sec:    272.74</span><br><span class="line">Transfer/sec:     74.04KB</span><br></pre></td></tr></table></figure>

<h4 id="2-4-4-G1-收集器测试"><a href="#2-4-4-G1-收集器测试" class="headerlink" title="2.4.4 G1 收集器测试"></a>2.4.4 G1 收集器测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">JVM启动参数</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xms512m</span><br><span class="line"></span><br><span class="line">压测结果:</span><br><span class="line">MacBook-Pro:~ xuxiancheng$ wrk -t4 -c50 -d60s http://localhost:8080/v1/research/info?id=11</span><br><span class="line">Running 1m test @ http://localhost:8080/v1/research/info?id=11</span><br><span class="line">  4 threads and 50 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br><span class="line">    Latency    28.30ms   14.92ms 250.01ms   86.90%</span><br><span class="line">    Req/Sec   229.81    120.19   777.00     86.65%</span><br><span class="line">  16385 requests in 1.03m, 4.34MB read</span><br><span class="line">  Socket errors: connect 0, read 4, write 0, timeout 0</span><br><span class="line">  Non-2xx or 3xx responses: 16385</span><br><span class="line">Requests/sec:    265.09</span><br><span class="line">Transfer/sec:     71.97KB</span><br><span class="line"></span><br><span class="line">G1GC在大内存情况下会比较有优势，这里使用512m其实并不能发挥G1收集器的优势</span><br></pre></td></tr></table></figure>


            <div class="post-copyright">
    <div class="content">
        <p>原始链接： <a class="post-url" href="/2020/10/25/JVM-01-内存管理/" title="JVM-01-内存管理">http://xuxiancheng.xyz/2020/10/25/JVM-01-内存管理/</a></p>
        <footer>
            <a href="http://xuxiancheng.xyz">
                <img src="/images/logo1.png" alt="xuxiancheng">
                xuxiancheng
            </a>
        </footer>
    </div>
</div>

      
        
    </div>
    <footer class="article-footer">
        
        <ul class="article-footer-menu">
            
                <li><i class="fa fa-calendar"></i>2020-10-25</li>
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/jvm/" class="color4">jvm</a>
      
  </li>

        </ul>
        
            <a href="/2020/10/25/JVM-01-内存管理/#more" class="article-more-link" >more&gt;&gt;</a>
        
    </footer>
  </div>
</article>


  

</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> @2017-2020 xuxiancheng
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://xuxiancheng.xyz",
      animate: true,
      isHome: true,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/Java/">Java</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/jvm/" style="font-size: 10px;">jvm</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/jvm/" style="font-size: 10px;">jvm</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>


  </div>
</body>
</html>